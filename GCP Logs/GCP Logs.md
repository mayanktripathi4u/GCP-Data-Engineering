# What is GCP Audit Logs?
Google Cloud Services write Audit Logs that records
1. <span style="color: green;">Administrative Activities</span> of your Google Cloud Resources.
2. <span style="color: green;">Accesses</span> within your Google Cloud Resoiurces.

Audit Logs help us answer:
1. <span style="color: orange;">Who did what?</span>
2. <span style="color: red;">Where?</span>
3. <span style="color: skyblue;">When?</span>

# What is Log Explorer?
You can use to <span style="color: orange;">**retrieve, view, and analyse log data**</span>. The Logs Explorer lets you find and view your logs so that you can trobleshoot problems.

# Types of Audit Logs in GCP Cloud
1. Admin Activities Audit Logs
2. Data Access Logs
3. System Event Logs
4. Policy Denied Logs

<span style="color: orange;">Google Cloud audit logs</span> provide detailed records of operations performed within your Google Cloud resources. When imported into BigQuery, you can extract valuable insights regarding security, compliance, and operational monitoring. Here’s an overview of what information you can gather and how it can be useful:

# Information Gathered from Audit Logs:
1. Log Types:
* Admin Activity Logs: Changes made to resources (e.g., creating/deleting VMs).
* Data Access Logs: Access to data (e.g., reading/writing data in Cloud Storage).
* System Event Logs: Events generated by Google Cloud services (e.g., auto-scaling).

2. Key Details:
* Timestamp: When the action occurred.
* User Identity: Who performed the action (user account or service account).
* Resource Type: Type of resource affected (e.g., Compute Engine, Cloud Storage).
* Action Taken: The specific operation (e.g., CREATE, DELETE).
* Project ID: The project associated with the action.
* Request and Response: Details of the API call, including any error messages.

# Usefulness of Audit Logs:
* Security Monitoring: Detect unauthorized access or changes.
* Compliance: Ensure adherence to policies and regulations by tracking user actions.
* Operational Insights: Understand usage patterns and resource management.
* Troubleshooting: Identify the source of errors and operational issues.

# Sample Query in BigQuery:
Here’s a sample SQL query to analyze user activity over the last month, focusing on the number of actions performed per user:

```sql
SELECT 
    protoPayload.authenticationInfo.principalEmail AS user_email,
    COUNT(*) AS action_count,
    STRING_AGG(DISTINCT protoPayload.methodName) AS actions,
    DATE(protoPayload.timestamp) AS action_date
FROM 
    `YOUR_PROJECT.YOUR_DATASET.your_audit_logs_table`
WHERE 
    DATE(protoPayload.timestamp) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY)
GROUP BY 
    user_email, action_date
ORDER BY 
    action_date DESC, action_count DESC
LIMIT 100
```

Another is to get the User Activity such as Create; Update; Insert on any Resource.

```sql
SELECT 
    protoPayload.authenticationInfo.principalEmail AS user_email, 
    COUNT(*) AS action_count, 
    STRING_AGG(DISTINCT protoPayload.methodName) AS actions, 
    DATE(protoPayload.timestamp) AS action_date 
FROM `YOUR_PROJECT.YOUR_DATASET.your_audit_logs_table` 
WHERE 1 = 1
    ANd DATE(protoPayload.timestamp) >= DATE_SUB(CURRENT_DATE(), INTERVAL 30 DAY) 
    AND REGEXP_CONTAINS(protoPayload.methodName, r"(create|update|insert)") 
    GROUP BY user_email, action_date 
    ORDER BY action_date DESC, action_count DESC 
LIMIT 100
```

Importing Google Cloud audit logs into BigQuery can provide actionable insights into your cloud environment, enhancing security, compliance, and operational effectiveness. You can adapt the sample query to focus on different aspects of your audit logs based on your specific needs


